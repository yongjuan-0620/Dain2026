<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾¾å› å¯ä¹å®š æ‚£è€…æµæ¼”è¿›çœ‹æ¿</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700;900&display=swap');
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #1a2035; /* æ·±è‰²èƒŒæ™¯ */
            color: #d1d5db; /* é»˜è®¤æ–‡å­—é¢œè‰² text-gray-300 */
            overflow: hidden; /* é˜²æ­¢æ»šåŠ¨æ¡å‡ºç°ï¼Œå¦‚æœå†…å®¹è¿‡å¤šå¯ä»¥è°ƒæ•´ */
        }

        /* ç™»å½•ç•Œé¢çš„ç‰¹å®šæ ·å¼ */
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #ec4899; /* ç™»é™†èƒŒæ™¯è‰² */
            background-image: linear-gradient(to bottom right, #ec4899, #8b5cf6); /* æ¸å˜ */
        }

        .login-card {
            background-color: rgba(255, 255, 255, 0.15); /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ */
            backdrop-filter: blur(10px); /* æ¯›ç»ç’ƒæ•ˆæœ */
            border-radius: 2rem; /* å¤§åœ†è§’ */
            padding: 2.5rem; /* å¢åŠ å†…è¾¹è· */
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            color: white; /* ç¡®ä¿æ–‡å­—æ˜¯ç™½è‰² */
            border: 1px solid rgba(255, 255, 255, 0.2); /* è¾¹æ¡† */
        }

        .login-icon {
            background-color: white;
            border-radius: 1.5rem; /* å¤§åœ†è§’ */
            padding: 1.25rem;
            display: inline-block;
            margin-bottom: 2rem; /* å¢åŠ åº•éƒ¨é—´è· */
        }

        .login-icon svg {
            color: #ec4899; /* å’Œä¸»è‰²è°ƒä¸€è‡´ */
            width: 3rem; /* å¢å¤§å›¾æ ‡ */
            height: 3rem;
        }

        .login-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 900; /* font-black */
            margin-bottom: 2.5rem; /* å¢åŠ åº•éƒ¨é—´è· */
        }

        .login-input {
            background-color: rgba(255, 255, 255, 0.3); /* åŠé€æ˜è¾“å…¥æ¡† */
            border: none;
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1rem 1.5rem; /* å¢åŠ å†…è¾¹è· */
            color: white;
            font-size: 1.125rem; /* text-lg */
            margin-bottom: 1.5rem;
            width: 100%;
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .login-button {
            background-color: #ec4899; /* æŒ‰é’®é¢œè‰² */
            background-image: linear-gradient(to right, #ec4899, #f472b6); /* æŒ‰é’®æ¸å˜ */
            color: white;
            font-weight: 700; /* font-bold */
            padding: 1rem 1.5rem;
            border-radius: 0.75rem; /* rounded-xl */
            font-size: 1.25rem; /* text-xl */
            width: 100%;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4); /* æŒ‰é’®é˜´å½± */
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.6);
        }

        .error-message {
            color: #fca5a5; /* red-300 */
            margin-top: 1rem;
            font-size: 0.875rem;
            height: 1.25rem; /* é¢„ç•™ç©ºé—´é¿å…å¸ƒå±€è·³åŠ¨ */
        }


        /* ä»¥ä¸‹æ˜¯ä»ªè¡¨æ¿çš„æ ·å¼ï¼Œä¸ä¹‹å‰ç›¸åŒ */

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .main-title {
            @apply text-white;
        }
        .subtitle {
            @apply text-gray-400;
        }

        /* å¹´ä»½é€‰æ‹©å™¨ */
        .year-btn {
            @apply px-4 py-2 text-sm font-bold rounded-full transition cursor-pointer;
            background-color: #3f4a6e; /* æŒ‰é’®é»˜è®¤èƒŒæ™¯ */
            color: #d1d5db; /* æŒ‰é’®é»˜è®¤æ–‡å­—é¢œè‰² */
            border: none;
        }
        .year-btn.active {
            background-color: #ec4899; /* pink-500 */
            color: white;
            box-shadow: 0 0 10px rgba(236, 72, 153, 0.5); /* æ´»æ€§ç²‰è‰²å‘å…‰ */
        }
        .year-btn:hover:not(.active) {
            background-color: #4a557c; /* ç¨äº®ä¸€ç‚¹çš„èƒŒæ™¯ */
        }

        /* å‚æ•°æ»‘å—æ ·å¼ */
        .param-slider {
            @apply w-full h-2 rounded-lg appearance-none cursor-pointer;
            background: linear-gradient(to right, #ec4899, #8b5cf6); /* æ¸å˜è‰² */
        }
        .param-slider::-webkit-slider-thumb {
            @apply appearance-none w-4 h-4 rounded-full shadow-lg;
            background: white;
            border: 2px solid #ec4899;
        }
        .param-slider::-moz-range-thumb {
            @apply appearance-none w-4 h-4 rounded-full shadow-lg;
            background: white;
            border: 2px solid #ec4899;
        }

        /* é€‚ç”¨äº contenteditable çš„æ ·å¼ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒæ™®é€šæ–‡æœ¬ */
        .contenteditable-styled {
            @apply p-0 border-none bg-transparent focus:outline-none focus:ring-0;
            white-space: pre-wrap; /* ä¿ç•™æ¢è¡Œå’Œç©ºæ ¼ */
            line-height: 1.5; /* ç¡®ä¿èˆ’é€‚çš„è¡Œé«˜ */
            min-height: 1em; /* ç¡®ä¿ç©ºæ—¶æœ‰é«˜åº¦ */
            font-size: 0.875rem; /* é»˜è®¤ text-sm */
            color: #d1d5db; /* é»˜è®¤æ–‡å­—é¢œè‰² */
        }
        /* é’ˆå¯¹æ·±è‰²èƒŒæ™¯çš„å¯ç¼–è¾‘å†…å®¹ */
        .contenteditable-dark {
            @apply text-white;
        }
        /* PMæ´å¯Ÿ/ç­–ç•¥è´´å£«çš„å­—ä½“æ›´å° */
        .contenteditable-xs {
            font-size: 0.75rem; /* text-xs */
        }

        /* å¯ç¼–è¾‘æ•°å­—è¾“å…¥æ¡† */
        .editable-input-number {
            @apply w-20 p-1 text-base font-bold text-green-400 bg-gray-700 border border-gray-600 rounded-md text-center;
        }

        /* å“ç±»ä»½é¢çš„è¾“å…¥æ¡† */
        .category-share-input {
            @apply w-16 p-1 text-sm font-bold text-gray-200 bg-gray-700 border border-gray-600 rounded-md text-center;
        }

        /* ç»Ÿä¸€çš„KPI/é¢„æµ‹å€¼æ˜¾ç¤ºæ ·å¼ - å‚ç…§å›¾ç‰‡æ ·å¼ */
        .forecast-metric-container {
            @apply flex flex-col items-center justify-center p-3 rounded-lg shadow-sm border border-gray-700; /* rounded-lg for more square corners */
            background-color: #3f4a6e; /* ä¸å¹´ä»½æŒ‰é’®ç›¸ä¼¼çš„èƒŒæ™¯ */
        }
        .forecast-metric-label {
            @apply text-xs font-bold text-gray-400 uppercase mb-1; /* å­—å·ç¼©å°ï¼ŒåŠ ç²— */
        }
        /* è°ƒæ•´åçš„KPIå€¼æ ·å¼ */
        .forecast-metric-value {
            @apply text-2xl font-black; /* æ›´å¤§æ›´ç²— */
            color: #ec4899; /* é»˜è®¤ç²‰è‰²ï¼Œå¯æ ¹æ®å…·ä½“KPIè°ƒæ•´ */
        }
        /* ç‰¹æ®Šé¢œè‰²ç”¨äºä¸€äº›è“è‰²å¼ºè°ƒçš„KPIs */
        .forecast-metric-value.blue {
            color: #8b5cf6; /* ç´«è“è‰² */
        }

        .forecast-metric-unit {
            @apply text-xs text-gray-500 mt-0;
        }

        /* æ‚£è€…æµæ¨¡å‹ä¸­çš„è¿›åº¦æ¡æ•ˆæœ */
        .funnel-item {
            @apply p-3 rounded-lg flex justify-between items-center;
        }
        .funnel-item-bg-1 { background-color: #3f4a6e; } /* ç±»ä¼¼ KPI å®¹å™¨èƒŒæ™¯ */
        .funnel-item-bg-2 { background-color: #4a557c; } /* ç¨æ·±ä¸€ç‚¹ */
        .funnel-item-bg-3 { background-color: #55608a; } /* æ›´æ·± */
        .funnel-item-bg-4 { background-color: #606b98; } /* æœ€æ·± */
        .funnel-item-label { @apply text-sm font-bold text-gray-300; }
        .funnel-item-value { @apply text-base font-bold text-white; }
        .funnel-item-value.blue-highlight {
            @apply text-lg font-black text-blue-300; /* çªå‡ºæ˜¾ç¤ºæ ¸å¿ƒç›®æ ‡ */
        }


        /* é”€å”®é¢å¤§å­—æ˜¾ç¤º */
        .current-revenue-display {
            @apply text-pink-400; /* ç²‰è‰² */
        }

        /* Chart.js å›¾è¡¨æ ·å¼è¦†ç›– */
        canvas {
            background-color: transparent !important;
        }
        .chartjs-tooltip {
            background-color: rgba(30, 41, 59, 0.9) !important; /* Tailwind gray-800 with opacity */
            color: white !important;
            border-radius: 0.75rem !important; /* rounded-xl */
            padding: 12px !important;
        }
        .chartjs-tooltip-header-item, .chartjs-tooltip-body-item {
            color: white !important;
        }
        .chartjs-tooltip-title {
            font-size: 13px !important;
            font-weight: bold !important;
        }
        .chartjs-tooltip-body {
            font-size: 12px !important;
        }

        /* å“ç±»ä»½é¢æ’ç‰ˆä¼˜åŒ– */
        .category-share-row {
            display: grid;
            grid-template-columns: 1fr auto auto auto; /* å“ç±»å | è¾“å…¥æ¡† | % | æ²»ç–—çº¿ */
            align-items: center;
            gap: 0.5rem; /* é—´è· */
            font-size: 0.875rem; /* text-sm */
            margin-bottom: 0.5rem;
        }
        .category-share-row span:first-child {
             text-align: left;
        }
        .category-share-row .share-input-group {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            justify-self: end; /* é å³å¯¹é½ */
        }
        .category-share-row .share-input-group .category-share-input {
            width: 4rem; /* ç»Ÿä¸€è¾“å…¥æ¡†å®½åº¦ */
        }
        .category-share-row .share-unit {
             font-weight: bold;
             color: #d1d5db;
        }
        .category-share-row .treatment-line {
            font-size: 0.75rem; /* text-xs */
            color: #9ca3af; /* text-gray-400 */
            text-align: right;
            white-space: nowrap; /* ä¸æ¢è¡Œ */
        }
        .category-share-row.clonidine { /* å¯ä¹å®šè¡Œ */
             font-weight: bold;
             color: #34d399; /* text-emerald-400 */
        }
        .category-share-row.clonidine .treatment-line {
            color: #d1d5db; /* å¯ä¹å®šæ²»ç–—çº¿æ›´äº® */
        }
    </style>
</head>
<body class="p-6 flex flex-col h-screen">

    <!-- ç™»å½•ç•Œé¢ -->
    <div id="login-container">
        <div class="login-card">
            <div class="login-icon">
                <!-- Lucide Icons çš„ pulse å›¾æ ‡ -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pulse"><path d="M19 10c-1.3-3.9-4.8-6.4-8.8-7H3l2.7 5h4.1l.6 1.5 2.1 4.5H19l-2.1 4.5-.6 1.5H8.8L6.7 21H3l2.7-5h6.2c4 0 7.5-2.5 8.8-6.4V10z"></path></svg>
            </div>
            <h1 class="login-title">æˆ˜ç•¥æ¼”è¿›æ¨æ¼”ç³»ç»Ÿ</h1>
            <input type="password" id="password-input" class="login-input" placeholder="è®¿é—®å¯†é’¥">
            <button id="login-button" class="login-button">éªŒè¯è¿›å…¥</button>
            <p id="error-message" class="error-message"></p>
        </div>
    </div>

    <!-- ä»ªè¡¨æ¿å†…å®¹ (é»˜è®¤éšè—) -->
    <div id="dashboard-container" class="hidden flex-1 overflow-y-auto flex flex-col">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <div class="mb-4">
            <h1 class="text-4xl font-black main-title italic">è¾¾å› å¯ä¹å®š æ‚£è€…æµæ¼”è¿›çœ‹æ¿</h1>
            <p class="text-sm subtitle mt-1">ä¸­å›½å„¿ç«¥ ADHD å¸‚åœº | 2023-2035 åŠ¨æ€é¢„ä¼° | å®æ—¶äº¤äº’</p>
        </div>

        <!-- å¹´ä»½é€‰æ‹©å™¨ -->
        <div class="mb-6 flex gap-2 overflow-x-auto pb-2">
            <button onclick="switchYear(2023)" class="year-btn" id="btn-2023">2023</button>
            <button onclick="switchYear(2024)" class="year-btn" id="btn-2024">2024</button>
            <button onclick="switchYear(2025)" class="year-btn" id="btn-2025">2025</button>
            <button onclick="switchYear(2026)" class="year-btn active" id="btn-2026">2026</button>
            <button onclick="switchYear(2027)" class="year-btn" id="btn-2027">2027</button>
            <button onclick="switchYear(2028)" class="year-btn" id="btn-2028">2028</button>
            <button onclick="switchYear(2029)" class="year-btn" id="btn-2029">2029</button>
            <button onclick="switchYear(2030)" class="year-btn" id="btn-2030">2030</button>
            <button onclick="switchYear(2031)" class="year-btn" id="btn-2031">2031</button>
            <button onclick="switchYear(2032)" class="year-btn" id="btn-2032">2032</button>
            <button onclick="switchYear(2033)" class="year-btn" id="btn-2033">2033</button>
            <button onclick="switchYear(2034)" class="year-btn" id="btn-2034">2034</button>
            <button onclick="switchYear(2035)" class="year-btn" id="btn-2035">2035</button>
        </div>

        <!-- ä¸»å®¹å™¨ -->
        <div class="flex-1 overflow-y-auto grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- å·¦ä¾§ï¼šå‚æ•°è°ƒæ•´é¢æ¿ -->
            <div class="lg:col-span-1 space-y-4 flex-shrink-0">
                <div class="bg-gray-800 p-6 rounded-[2rem] shadow-lg border border-gray-700 sticky top-0">
                    <h3 class="text-lg font-bold text-pink-500 mb-4 flex items-center gap-2">
                        <i data-lucide="sliders"></i> é¢„ä¼°å‚æ•°
                    </h3>

                    <!-- äººå£åŸºç¡€å‚æ•° -->
                    <div class="bg-gray-700 p-3 rounded-lg mb-4 border border-gray-600">
                        <p class="text-xs font-black text-blue-400 uppercase mb-2">ğŸ‘¶ äººå£åŸºç¡€å‚æ•°</p>

                        <label class="block text-xs font-bold text-gray-300 mb-1">6-17å²æ€»äººå£ (ä¸‡äºº) <span class="text-gray-500" id="param-year-hint-total-pop"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-total-pop" min="1000" max="25000" value="2500" oninput="updateParams()" class="param-slider">
                            <span id="v-total-pop" class="text-sm font-bold text-blue-400 w-12 text-right">2500</span>
                        </div>

                        <label class="block text-xs font-bold text-gray-300 mt-3 mb-1">åŸé•‡åŒ–ç‡ (%) <span class="text-gray-500" id="param-year-hint-urban"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-urban" min="50" max="85" value="66" oninput="updateParams()" class="param-slider">
                            <span id="v-urban" class="text-sm font-bold text-blue-400 w-10 text-right">66%</span>
                        </div>
                    </div>

                    <!-- æ‚£ç—…åŠè¯Šæ–­å‚æ•° -->
                    <div class="bg-gray-700 p-3 rounded-lg mb-4 border border-gray-600">
                        <p class="text-xs font-black text-purple-400 uppercase mb-2">ğŸ” æ‚£ç—…åŠè¯Šæ–­å‚æ•°</p>

                        <label class="block text-xs font-bold text-gray-300 mb-1">æ‚£ç—…ç‡ (%) <span class="text-gray-500" id="param-year-hint-prevalence"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-prevalence" min="3" max="10" value="6.2" step="0.1" oninput="updateParams()" class="param-slider">
                            <span id="v-prevalence" class="text-sm font-bold text-purple-400 w-10 text-right">6.2%</span>
                        </div>

                        <label class="block text-xs font-bold text-gray-300 mt-3 mb-1">è¯Šæ–­ç‡ (%) <span class="text-gray-500" id="param-year-hint-diagnosis"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-diagnosis" min="5" max="40" value="15" oninput="updateParams()" class="param-slider">
                            <span id="v-diagnosis" class="text-sm font-bold text-purple-400 w-10 text-right">15%</span>
                        </div>

                        <label class="block text-xs font-bold text-gray-300 mt-3 mb-1">ADHDåˆå¹¶TDæ¯”ä¾‹ (%) <span class="text-gray-500" id="param-year-hint-comorbid-td"></span></label>
                        <div class="flex gap-2 items-center">
                            <input type="range" id="p-comorbid-td" min="0" max="100" value="30" step="1" oninput="updateParams()" class="param-slider">
                            <span id="v-comorbid-td" class="text-2xl font-black text-pink-400 w-16 text-right">30%</span>
                        </div>
                    </div>

                    <!-- ç”¨è¯ç›¸å…³å‚æ•° -->
                    <div class="bg-gray-700 p-3 rounded-lg mb-4 border border-gray-600">
                        <p class="text-xs font-black text-green-400 uppercase mb-2">ğŸ’Š ç”¨è¯ç›¸å…³å‚æ•°</p>

                        <label class="block text-xs font-bold text-gray-300 mb-1">è¯ç‰©æ²»ç–—æ¯”ä¾‹ (%) <span class="text-gray-500" id="param-year-hint-treatment"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-treatment" min="30" max="90" value="70" oninput="updateParams()" class="param-slider">
                            <span id="v-treatment" class="text-sm font-bold text-green-400 w-10 text-right">70%</span>
                        </div>
                    </div>

                    <!-- å“ç±»ä¸å“ç‰Œä»½é¢ -->
                    <div class="bg-gray-700 p-3 rounded-lg mb-4 border border-gray-600">
                        <p class="text-xs font-black text-orange-400 uppercase mb-2">ğŸ“Š å“ç±»ä¸å“ç‰Œä»½é¢</p>

                        <label class="block text-xs font-bold text-gray-300 mb-1">å¯ä¹å®šå“ç±»ä»½é¢ (%) <span class="text-gray-500" id="param-year-hint-category-share"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-category-share" min="3" max="20" value="5" oninput="updateParams()" class="param-slider">
                            <span id="v-category-share" class="text-sm font-bold text-orange-400 w-10 text-right">5%</span>
                        </div>

                        <label class="block text-xs font-bold text-gray-300 mt-3 mb-1">å¯ä¹å®šä¸­è¾¾å› ä»½é¢ (%) <span class="text-gray-500" id="param-year-hint-brand-share"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-brand-share" min="20" max="80" value="40" oninput="updateParams()" class="param-slider">
                            <span id="v-brand-share" class="text-sm font-bold text-orange-400 w-10 text-right">40%</span>
                        </div>
                    </div>

                    <!-- å¤„æ–¹ä¸å¤è´­ -->
                    <div class="bg-gray-700 p-3 rounded-lg border border-gray-600">
                        <p class="text-xs font-black text-pink-400 uppercase mb-2">ğŸ”„ å¤„æ–¹ä¸å¤è´­</p>

                        <label class="block text-xs font-bold text-gray-300 mb-1">å•æ¬¡å¤„æ–¹ç‰‡æ•° <span class="text-gray-500" id="param-year-hint-prescription"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-prescription" min="14" max="90" value="30" oninput="updateParams()" class="param-slider">
                            <span id="v-prescription" class="text-sm font-bold text-pink-400 w-12 text-right">30</span>
                        </div>

                        <label class="block text-xs font-bold text-gray-300 mt-3 mb-1">å¹´åº¦å¤è´­æ¬¡æ•° <span class="text-gray-500" id="param-year-hint-annual-count"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-annual-count" min="6" max="24" value="12" oninput="updateParams()" class="param-slider">
                            <span id="v-annual-count" class="text-sm font-bold text-pink-400 w-10 text-right">12</span>
                        </div>

                        <!-- æ–°å¢äº§å“å•ä»· -->
                        <label class="block text-xs font-bold text-gray-300 mt-3 mb-1">äº§å“å•ä»· (å…ƒ/ç‰‡) <span class="text-gray-500" id="param-year-hint-unit-price"></span></label>
                        <div class="flex gap-2">
                            <input type="range" id="p-unit-price" min="0.5" max="12" value="2" step="0.1" oninput="updateParams()" class="param-slider">
                            <span id="v-unit-price" class="text-sm font-bold text-pink-400 w-10 text-right">2.0</span>
                        </div>
                    </div>

                    <button onclick="resetParams()" class="w-full mt-4 bg-gray-700 text-gray-300 py-2 rounded-lg font-bold text-xs hover:bg-gray-600 transition">
                        é‡ç½®å‚æ•°
                    </button>
                </div>
            </div>

            <!-- å³ä¾§ï¼šæ•°æ®çœ‹æ¿ -->
            <div class="lg:col-span-2 space-y-6">

                <!-- 2023-2035 é”€å”®é¢„ä¼° (å·²ç§»åŠ¨åˆ°æœ€ä¸Šæ–¹) -->
                <div class="bg-gray-800 p-6 rounded-[2rem] shadow-lg border border-gray-700">
                    <h3 class="text-lg font-bold text-pink-500 mb-4 flex items-center gap-2">
                        <i data-lucide="trending-up"></i> 2023-2035 é”€å”®é¢„ä¼° (<span id="forecast-model-year">2026</span>)
                    </h3>

                    <!-- é¡¶éƒ¨çš„é¢„æµ‹å‚æ•°å’Œé¢„æµ‹é”€å”®é¢ -->
                    <div class="grid grid-cols-3 gap-4 mb-6 text-center">
                        <div class="forecast-metric-container">
                            <p class="forecast-metric-label">è¯ç‰©æ²»ç–—æ¯”ä¾‹</p>
                            <p class="forecast-metric-value" id="forecast-treatment-rate">70<span class="text-base">%</span></p>
                        </div>
                        <div class="forecast-metric-container">
                            <p class="forecast-metric-label">å¯ä¹å®šå“ç±»ä»½é¢</p>
                            <p class="forecast-metric-value" id="forecast-category-share">5<span class="text-base">%</span></p>
                        </div>
                        <div class="forecast-metric-container">
                            <p class="forecast-metric-label">è¾¾å› å¯ä¹å®šä»½é¢</p>
                            <p class="forecast-metric-value" id="forecast-brand-share">40<span class="text-base">%</span></p>
                        </div>

                        <!-- KPI ç§»åŠ¨åˆ°è¿™é‡Œï¼Œå¹¶é‡‡ç”¨ç»Ÿä¸€æ ¼å¼ -->
                        <div class="forecast-metric-container">
                            <p class="forecast-metric-label">é¢„ä¼°æ‚£è€…æ•°</p>
                            <p class="forecast-metric-value" id="kpi-patients" style="color:#ec4899;"></p>
                        </div>
                        <div class="forecast-metric-container">
                            <p class="forecast-metric-label">é¢„ä¼°é”€å”®é¢</p>
                            <p class="forecast-metric-value blue" id="kpi-revenue"></p>
                            <p class="forecast-metric-unit">ä¸‡å…ƒ</p>
                        </div>
                        <div class="forecast-metric-container">
                            <p class="forecast-metric-label">äººå‡å¹´æ¶ˆè´¹</p>
                            <p class="forecast-metric-value blue" id="kpi-percapita"></p>
                            <p class="forecast-metric-unit">å…ƒ</p>
                        </div>
                    </div>

                    <div class="bg-gray-900 text-white text-center p-4 rounded-xl mb-6">
                        <p class="text-sm font-bold uppercase mb-1 text-gray-400">å½“å‰å¹´ä»½ (<span id="current-forecast-year">2035</span>) é¢„æµ‹é”€å”®é¢</p>
                        <p class="text-5xl font-black current-revenue-display">Â¥<span id="current-forecast-revenue">0</span></p>
                    </div>

                    <!-- è¶‹åŠ¿å›¾ -->
                    <h4 class="font-bold text-gray-200 mb-4 flex items-center gap-2">
                        <i data-lucide="line-chart"></i> 2023-2035 è¾¾å› å¯ä¹å®šè¶‹åŠ¿å¤–æ¨ (å…¨æ¸ é“)
                    </h4>
                    <div class="h-64 mb-6">
                        <canvas id="trendChart"></canvas>
                    </div>

                    <!-- æµ‹ç®—é€»è¾‘æ˜ç»† (2035) -->
                    <h4 class="font-bold text-gray-200 mb-3 flex items-center gap-2">
                        <i data-lucide="calculator"></i> æµ‹ç®—é€»è¾‘æ˜ç»† (<span id="calc-logic-year">2035</span>)
                    </h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><span class="text-gray-400">6-17å²åŸå¸‚æ‚£å„¿</span></div><div class="text-right font-bold text-pink-400" id="calc-urban-children">0ä¸‡</div>
                        <div><span class="text-gray-400">ç¡®è¯Šæ‚£å„¿æ•°</span></div><div class="text-right font-bold text-pink-400" id="calc-diagnosed-children">0ä¸‡</div>
                        <div><span class="text-gray-400">å¯ä¹å®šå“ç±»äººç¾¤</span></div><div class="text-right font-bold text-pink-400" id="calc-category-patients">0ä¸‡</div>
                        <div><span class="text-gray-400">è¾¾å› è¦†ç›–äººæ•°</span></div><div class="text-right font-bold text-pink-400" id="calc-dain-coverage">0äºº</div>
                    </div>

                    <div class="bg-gray-700 p-3 rounded-lg mt-4 border border-gray-600">
                        <p class="text-xs font-bold text-blue-400 flex items-start gap-1">
                            <i data-lucide="lightbulb" class="w-4 h-4"></i> PM ç­–ç•¥è´´å£«:
                        </p>
                        <div id="editable-pm-strategy-tip" contenteditable="true" class="contenteditable-styled contenteditable-xs text-blue-300" placeholder="è¾“å…¥PMç­–ç•¥è´´å£«..."></div>
                    </div>
                </div>

                <!-- æ ¸å¿ƒç›®æ ‡ç¾¤ ä¸ ç«äº‰å£å’å»ºè®® -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- æ ¸å¿ƒç›®æ ‡ç¾¤ å¡ç‰‡ -->
                    <div class="bg-gray-800 p-4 rounded-[2rem] shadow-lg border border-gray-700 flex flex-col justify-between"> <!-- padding è°ƒæ•´ä¸º p-4 -->
                        <h3 class="text-lg font-bold text-pink-500 mb-2 flex items-center gap-2">
                            <i data-lucide="target"></i> æ ¸å¿ƒç›®æ ‡ç¾¤: ADHD+TD
                        </h3>
                        <div class="text-sm text-gray-300 mb-4">
                            <div id="editable-target-group-text" contenteditable="true" class="contenteditable-styled" placeholder="è¾“å…¥æ ¸å¿ƒç›®æ ‡ç¾¤ç›¸å…³æ´å¯Ÿ..."></div>
                        </div>
                        <div class="bg-gray-700 p-3 rounded-lg border border-gray-600 text-center">
                            <p class="text-xs font-bold text-green-400 uppercase">è¯¥äºšç»„é¢„ä¼°æ‚£è€…è§„æ¨¡:</p>
                            <div class="flex justify-center items-center gap-2 mt-1">
                                <!-- å·²æ”¹ä¸ºè‡ªåŠ¨è®¡ç®—æ˜¾ç¤º -->
                                <span id="target-patient-group-size-display" class="text-3xl font-black text-pink-400">0.0</span>
                                <span class="text-xl font-black text-pink-400">ä¸‡</span>
                            </div>
                        </div>
                    </div>

                    <!-- ç«äº‰å£å’å»ºè®® å¡ç‰‡ -->
                    <div class="bg-gray-800 p-4 rounded-[2rem] shadow-lg border border-gray-700 text-white"> <!-- padding è°ƒæ•´ä¸º p-4 -->
                        <h3 class="text-lg font-bold text-blue-400 mb-4 flex items-center gap-2">
                            <i data-lucide="shield-check"></i> ç«äº‰å£å’å»ºè®®
                        </h3>
                        <div id="editable-competition-text" contenteditable="true" class="contenteditable-styled contenteditable-dark text-gray-300" placeholder="è¾“å…¥ç«äº‰å£å’å»ºè®®...">
                            <ul>
                                <li>å¼ºè°ƒâ€œç¼“é‡Šç‰‡â€è¾ƒæ™®é€šç‰‡å‰‚çš„è¡€è¯æµ“åº¦å¹³ç¨³æ€§,æå‡è€å—ã€‚</li>
                                <li>ç»‘å®šâ€œADHDä¸“å®¶å…±è¯†â€,å¼ºåŒ–åˆå¹¶TDæ—¶çš„ä¸€çº¿åœ°ä½ã€‚</li>
                                <li>å·®å¼‚åŒ–ç«äº‰:é¿å¼€æ‰˜è«è¥¿æ±€çš„é›†é‡‡çº¢æµ·ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- æ‚£è€…æµæ¨¡å‹ (åŸé•‡åŒ–è¿‡æ»¤) ä¸ å“ç±»ä»½é¢ç°çŠ¶ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- æ‚£è€…æµæ¨¡å‹ (åŸé•‡åŒ–è¿‡æ»¤) å¡ç‰‡ -->
                    <div class="bg-gray-800 p-6 rounded-[2rem] shadow-lg border border-gray-700">
                        <h3 class="text-lg font-bold text-pink-500 mb-4 flex items-center gap-2">
                            <i data-lucide="filter"></i> æ‚£è€…æµæ¨¡å‹ (åŸé•‡åŒ–è¿‡æ»¤) (<span id="funnel-year">2026</span>)
                        </h3>
                        <div class="space-y-3">
                            <div class="funnel-item funnel-item-bg-1">
                                <span class="funnel-item-label">6-17å²æ€»äººå£</span>
                                <span class="funnel-item-value" id="f-total-pop">0äº¿</span>
                            </div>
                            <div class="funnel-item funnel-item-bg-2">
                                <span class="funnel-item-label">åŸé•‡åŒ–è¦†ç›–äººç¾¤</span>
                                <span class="funnel-item-value" id="f-urban-pop">0ä¸‡</span>
                            </div>
                            <div class="funnel-item funnel-item-bg-3">
                                <span class="funnel-item-label text-indigo-300">ADHD æ‚£ç—…ç¾¤</span>
                                <span class="funnel-item-value" id="f-adhd-patients">0ä¸‡</span>
                            </div>
                            <div class="funnel-item funnel-item-bg-4">
                                <span class="funnel-item-label text-emerald-300">æ ¸å¿ƒç›®æ ‡: ADHD+TD äºšç»„</span>
                                <span class="funnel-item-value blue-highlight" id="f-target-patients">0ä¸‡</span>
                            </div>
                        </div>
                    </div>

                    <!-- å“ç±»ä»½é¢ç°çŠ¶ (2025) å¡ç‰‡ -->
                    <div class="bg-gray-800 p-6 rounded-[2rem] shadow-lg border border-gray-700 flex flex-col justify-between">
                        <h3 class="text-lg font-bold text-pink-500 mb-4 flex items-center gap-2">
                            <i data-lucide="pie-chart"></i> å“ç±»ä»½é¢ç°çŠ¶ (<span id="category-share-year">2025</span>)
                        </h3>
                        <div class="space-y-2 mb-4">
                            <!-- å“Œç”²é…¯ç±» -->
                            <div class="category-share-row">
                                <span class="text-gray-300">å“Œç”²é…¯ç±»ï¼ˆå…´å¥‹å‰‚ï¼‰</span>
                                <div class="share-input-group">
                                    <input type="number" id="input-share-stimulant" class="category-share-input" min="0" max="100" step="1" value="0" oninput="updateCategoryShares()">
                                </div>
                                <span class="share-unit">%</span>
                                <span class="treatment-line">(ä¸€çº¿)</span>
                            </div>
                            <!-- æ‰˜è«è¥¿æ±€ -->
                            <div class="category-share-row">
                                <span class="text-gray-300">æ‰˜è«è¥¿æ±€ï¼ˆéå…´å¥‹å‰‚ï¼‰</span>
                                <div class="share-input-group">
                                    <input type="number" id="input-share-atomoxetine" class="category-share-input" min="0" max="100" step="1" value="0" oninput="updateCategoryShares()">
                                </div>
                                <span class="share-unit">%</span>
                                <span class="treatment-line">(ä¸€çº¿)</span>
                            </div>
                             <!-- èƒæ³•è¾› -->
                            <div class="category-share-row">
                                <span class="text-gray-300">èƒæ³•è¾›ï¼ˆéå…´å¥‹å‰‚ï¼‰</span>
                                <div class="share-input-group">
                                    <input type="number" id="input-share-guanfacine" class="category-share-input" min="0" max="100" step="1" value="0" oninput="updateCategoryShares()">
                                </div>
                                <span class="share-unit">%</span>
                                <span class="treatment-line">(ADHDäºŒçº¿ã€ADHD+TDä¸€çº¿)</span>
                            </div>
                            <!-- å¯ä¹å®šç±» -->
                            <div class="category-share-row clonidine">
                                <span>å¯ä¹å®šç±»ï¼ˆéå…´å¥‹å‰‚ï¼‰</span>
                                <div class="share-input-group">
                                    <span id="display-share-clonidine" class="text-base font-bold">0</span>
                                </div>
                                <span class="share-unit">%</span>
                                <span class="treatment-line">(ADHDäºŒçº¿ã€ADHD+TDä¸€çº¿)</span>
                            </div>
                            <div class="text-red-400 text-xs mt-2 text-center" id="share-warning" style="display:none;">æ€»ä»½é¢ä¸ä¸º100%ï¼</div>
                        </div>
                        <div class="bg-gray-700 p-3 rounded-lg mt-4 border border-gray-600">
                            <p class="text-xs font-bold text-blue-400 flex items-start gap-1">
                                <i data-lucide="lightbulb" class="w-4 h-4"></i> PM æ´å¯Ÿ:
                            </p>
                            <div id="editable-pm-insight-text" contenteditable="true" class="contenteditable-styled contenteditable-xs text-blue-300" placeholder="è¾“å…¥PMæ´å¯Ÿ..."></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const CORRECT_PASSWORD = "KLD2026";
        const loginContainer = document.getElementById('login-container');
        const dashboardContainer = document.getElementById('dashboard-container');
        const passwordInput = document.getElementById('password-input');
        const loginButton = document.getElementById('login-button');
        const errorMessage = document.getElementById('error-message');

        loginButton.addEventListener('click', attemptLogin);
        passwordInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                attemptLogin();
            }
        });

        function attemptLogin() {
            const enteredPassword = passwordInput.value;
            if (enteredPassword === CORRECT_PASSWORD) {
                loginContainer.classList.add('hidden');
                dashboardContainer.classList.remove('hidden');
                lucide.createIcons(); // åˆå§‹åŒ–å›¾æ ‡
                initializeDashboard(); // åˆå§‹åŒ–ä»ªè¡¨æ¿
            } else {
                errorMessage.textContent = "å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚";
                passwordInput.value = ''; // æ¸…ç©ºå¯†ç è¾“å…¥æ¡†
            }
        }

        // é»˜è®¤æ˜¾ç¤ºç™»å½•ç•Œé¢ï¼Œéšè—ä»ªè¡¨æ¿
        loginContainer.classList.remove('hidden');
        dashboardContainer.classList.add('hidden');


        let currentYear = 2026;
        let trendChart = null;

        // åˆå§‹é»˜è®¤å‚æ•°
        const initialParams = {
            totalPop: 2500,      // 6-17å²æ€»äººå£(ä¸‡äºº)
            urban: 66,            // åŸé•‡åŒ–ç‡(%)
            prevalence: 6.2,      // æ‚£ç—…ç‡(%)
            diagnosis: 15,        // è¯Šæ–­ç‡(%) (åŸåŒ»é™¢å°±è¯Šç‡)
            comorbidTD: 30,       // ADHDåˆå¹¶TDæ¯”ä¾‹(%) - æ–°å¢
            treatment: 70,        // è¯ç‰©æ²»ç–—æ¯”ä¾‹(%)
            categoryShare: 5,     // å¯ä¹å®šå“ç±»ä»½é¢(%)
            brandShare: 40,       // è¾¾å› å“ç‰Œä»½é¢(%)
            prescription: 30,     // å•æ¬¡å¤„æ–¹ç‰‡æ•°
            annualCount: 12,       // å¹´åº¦å¤è´­æ¬¡æ•°
            unitPrice: 2.0         // äº§å“å•ä»· (å…ƒ/ç‰‡)
        };
        let params = { ...initialParams }; // å½“å‰å‚æ•°ï¼Œä¼šæ ¹æ®å¹´ä»½å’Œç”¨æˆ·ä¿®æ”¹è€Œå˜åŒ–

        // å­˜å‚¨æ¯ä¸ªå¹´ä»½çš„å‚æ•°è¦†ç›–æˆ–è°ƒæ•´
        let yearSpecificParams = {};

        // å­˜å‚¨ contenteditable æ–‡æœ¬çš„åˆå§‹é»˜è®¤å†…å®¹
        const initialEditableContents = {
            targetGroup: "é’ˆå¯¹è¿™éƒ¨åˆ†20%-50%çš„åˆå¹¶æŠ½åŠ¨éšœç¢æ‚£è€…ï¼Œè¾¾å› å¯ä¹å®šå…·æœ‰ç»å¯¹ä¸´åºŠé¦–é€‰æ¨èåœ°ä½ã€‚",
            competition: `<ul>
                <li>å¼ºè°ƒâ€œç¼“é‡Šç‰‡â€è¾ƒæ™®é€šç‰‡å‰‚çš„è¡€è¯æµ“åº¦å¹³ç¨³æ€§,æå‡è€å—ã€‚</li>
                <li>ç»‘å®šâ€œADHDä¸“å®¶å…±è¯†â€,å¼ºåŒ–åˆå¹¶TDæ—¶çš„ä¸€çº¿åœ°ä½ã€‚</li>
                <li>å·®å¼‚åŒ–ç«äº‰:é¿å¼€æ‰˜è«è¥¿æ±€çš„é›†é‡‡çº¢æµ·ã€‚</li>
            </ul>`,
            pmInsight: "2026è¾¾å› ä¸Šå¸‚éœ€æ‰“ç ´â€œäºŒçº¿æ²»ç–—â€æ ‡ç­¾,åˆ©ç”¨ç¼“é‡Šç‰‡å¹³ç¨³æ€§åˆ‡å…¥ ADHD+TDä¸€çº¿æ¨èã€‚",
            pmStrategy: "å›¾è¡¨æ˜¾ç¤ºï¼Œå¦‚æœè¯Šæ–­ç‡åœ¨2030å¹´èƒ½é€šè¿‡å­¦æœ¯æ¨å¹¿ä»15%æå‡è‡³20%ï¼Œè¾¾å› çš„è¥æ”¶æ›²çº¿å°†è·å¾—é¢å¤–çš„35%å¢é•¿ç©ºé—´ã€‚å»ºè®®åŠ å¤§éä¸“ç§‘åŒ»ç”Ÿçš„ADHDç­›æŸ¥åŸ¹è®­ã€‚"
        };
        let editableContents = { ...initialEditableContents };

        // å­˜å‚¨å“ç±»ä»½é¢çš„ç‹¬ç«‹ç¼–è¾‘å€¼
        // é”®æ˜¯å¹´ä»½ï¼Œå€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ { stimulant: 45, atomoxetine: 35, guanfacine: 10 }
        let yearSpecificCategoryShares = {};
        // é»˜è®¤å€¼ï¼Œå½“æ²¡æœ‰å¹´ä»½ç‰¹å®šå€¼æ—¶ä½¿ç”¨
        const defaultCategoryShares = {
            stimulant: 45,     // é»˜è®¤å“Œç”²é…¯ç±»ä»½é¢
            atomoxetine: 35,   // é»˜è®¤æ‰˜è«è¥¿æ±€ä»½é¢
            guanfacine: 10     // é»˜è®¤èƒæ³•è¾›ä»½é¢ - æ–°å¢
        };

        // LocalStorage Keys
        const LS_KEY_PARAMS = 'dainDashboard_yearSpecificParams';
        const LS_KEY_CATEGORY_SHARES = 'dainDashboard_yearSpecificCategoryShares';
        const LS_KEY_EDITABLE_CONTENTS = 'dainDashboard_editableContents';

        // --- LocalStorage Helper Functions ---
        function saveStateToLocalStorage() {
            try {
                localStorage.setItem(LS_KEY_PARAMS, JSON.stringify(yearSpecificParams));
                localStorage.setItem(LS_KEY_CATEGORY_SHARES, JSON.stringify(yearSpecificCategoryShares));
                localStorage.setItem(LS_KEY_EDITABLE_CONTENTS, JSON.stringify(editableContents));
                // console.log("State saved to LocalStorage.");
            } catch (e) {
                console.error("Error saving to LocalStorage:", e);
            }
        }

        function loadStateFromLocalStorage() {
            try {
                const savedParams = localStorage.getItem(LS_KEY_PARAMS);
                if (savedParams) {
                    yearSpecificParams = JSON.parse(savedParams);
                    // console.log("yearSpecificParams loaded:", yearSpecificParams);
                }

                const savedCategoryShares = localStorage.getItem(LS_KEY_CATEGORY_SHARES);
                if (savedCategoryShares) {
                    yearSpecificCategoryShares = JSON.parse(savedCategoryShares);
                    // console.log("yearSpecificCategoryShares loaded:", yearSpecificCategoryShares);
                }

                const savedEditableContents = localStorage.getItem(LS_KEY_EDITABLE_CONTENTS);
                if (savedEditableContents) {
                    editableContents = JSON.parse(savedEditableContents);
                    // console.log("editableContents loaded:", editableContents);
                }
                // console.log("State loaded from LocalStorage.");
            } catch (e) {
                console.error("Error loading from LocalStorage, using defaults:", e);
                // å¦‚æœåŠ è½½å¤±è´¥ï¼Œç¡®ä¿ä½¿ç”¨é»˜è®¤å€¼
                yearSpecificParams = {};
                yearSpecificCategoryShares = {};
                editableContents = { ...initialEditableContents };
            }
        }


        // ====== å®šä¹‰å‚æ•°éšå¹´ä»½æ¼”è¿›çš„é»˜è®¤è¶‹åŠ¿ (é‡è¦ï¼) ======
        const getDefaultUrbanRate = (year) => {
            if (year < 2023) return 65;
            if (year > 2035) return 75;
            return parseFloat((65 + (year - 2023) * ((75 - 65) / (2035 - 2023))).toFixed(1));
        };

        const getDefaultDiagnosisRate = (year) => { // ç°åœ¨æ˜¯â€œè¯Šæ–­ç‡â€
            if (year < 2023) return 10;
            if (year >= 2023 && year <= 2030) {
                return parseFloat((10 + (year - 2023) * ((20 - 10) / (2030 - 2023))).toFixed(1));
            }
            return 20;
        };

        const getDefaultTotalPop = (year) => {
            // å‡è®¾æ€»äººå£ä»2023å¹´2500ä¸‡ï¼Œæ¯å¹´é€’å‡50ä¸‡
            if (year < 2023) return 2500;
            // å…è®¸æœ€å¤§å€¼è¾¾åˆ°25000ï¼Œä½†é»˜è®¤è¶‹åŠ¿è¿˜æ˜¯åŸºäº2500
            const initialPopVal = 2500; // å‡è®¾2023å¹´çš„åˆå§‹å€¼
            const decreaseRate = 50; // æ¯å¹´é€’å‡50ä¸‡äºº
            const calculatedPop = initialPopVal - (year - 2023) * decreaseRate;
            return Math.max(1000, calculatedPop); // ç¡®ä¿ä¸ä½äºæŸä¸ªåˆç†å€¼
        };

        // å…¶ä»–å‚æ•°çš„é»˜è®¤è¶‹åŠ¿å‡½æ•°ï¼Œå¦‚æœä¸éœ€è¦å¹´ä»½è¶‹åŠ¿ï¼Œåˆ™ç›´æ¥ä»paramså½“å‰å€¼å–
        const getDefaultPrevalence = (year) => params.prevalence;
        const getDefaultComorbidTD = (year) => params.comorbidTD; // æ–°å¢
        const getDefaultTreatment = (year) => params.treatment;
        // å¯¹äºcategoryShareå’ŒbrandShareï¼Œå®ƒä»¬åœ¨paramså¯¹è±¡ä¸­ï¼Œä½†æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ç”¨æˆ·åœ¨å·¦ä¾§æ»‘å—çš„è°ƒæ•´ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä»paramså–
        const getDefaultCategoryShare = (year) => params.categoryShare;
        const getDefaultBrandShare = (year) => params.brandShare;
        const getDefaultPrescription = (year) => params.prescription;
        const getDefaultAnnualCount = (year) => params.annualCount;
        const getDefaultUnitPrice = (year) => params.unitPrice;


        // å¹´ä»½åˆ‡æ¢å‡½æ•°
        window.switchYear = function(year) {
            currentYear = year;
            document.querySelectorAll('.year-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${year}`).classList.add('active');

            loadYearParamsToUI(currentYear); // å°†å½“å‰å¹´ä»½æˆ–ç”¨æˆ·è¦†ç›–çš„å‚æ•°åŠ è½½åˆ°UI
            loadEditableContentsToUI(); // åŠ è½½å¯ç¼–è¾‘å†…å®¹
            loadCategorySharesToUI(currentYear); // åŠ è½½å“ç±»ä»½é¢çš„ç¼–è¾‘å€¼
            updateDisplay(); // é‡æ–°è®¡ç®—å¹¶æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
        };

        // å°†æŒ‡å®šå¹´ä»½çš„å‚æ•°åŠ è½½åˆ°UIè°ƒæ•´é¢æ¿
        function loadYearParamsToUI(year) {
            // è·å–è¯¥å¹´ä»½çš„åŸºå‡†å‚æ•°å€¼ï¼ˆé»˜è®¤è¶‹åŠ¿ + paramsä¸­çš„å½“å‰å€¼ï¼Œå¦‚æœæœªè¢«yearSpecificParamsè¦†ç›–ï¼‰
            let currentYearBaseParams = {
                totalPop: getDefaultTotalPop(year),
                urban: getDefaultUrbanRate(year),
                prevalence: params.prevalence, // ä»å½“å‰paramsä¸­å–ï¼Œä»¥ä¾¿ç”¨æˆ·æ»‘åŠ¨åä¿ç•™
                diagnosis: getDefaultDiagnosisRate(year),
                comorbidTD: params.comorbidTD,
                treatment: params.treatment,
                categoryShare: params.categoryShare,
                brandShare: params.brandShare,
                prescription: params.prescription,
                annualCount: params.annualCount,
                unitPrice: params.unitPrice
            };

            // å¦‚æœæœ‰å¹´ä»½ç‰¹å®šå‚æ•°è¦†ç›–ï¼Œåˆ™åº”ç”¨è¿™äº›è¦†ç›–
            if (yearSpecificParams[year]) {
                Object.assign(currentYearBaseParams, yearSpecificParams[year]);
            }
            
            // å°†æœ€ç»ˆå‚æ•°è®¾ç½®åˆ°paramså¯¹è±¡ï¼Œä»¥ä¾¿updateDisplayä½¿ç”¨
            Object.assign(params, currentYearBaseParams);

            document.getElementById('p-total-pop').value = params.totalPop;
            document.getElementById('v-total-pop').textContent = params.totalPop.toLocaleString();

            document.getElementById('p-urban').value = params.urban.toFixed(0);
            document.getElementById('v-urban').textContent = params.urban.toFixed(0) + '%';

            document.getElementById('p-prevalence').value = params.prevalence.toFixed(1);
            document.getElementById('v-prevalence').textContent = params.prevalence.toFixed(1) + '%';

            document.getElementById('p-diagnosis').value = params.diagnosis.toFixed(0);
            document.getElementById('v-diagnosis').textContent = params.diagnosis.toFixed(0) + '%';
            
            document.getElementById('p-comorbid-td').value = params.comorbidTD.toFixed(0);
            document.getElementById('v-comorbid-td').textContent = params.comorbidTD.toFixed(0) + '%';

            document.getElementById('p-treatment').value = params.treatment.toFixed(0);
            document.getElementById('v-treatment').textContent = params.treatment.toFixed(0) + '%';

            document.getElementById('p-category-share').value = params.categoryShare.toFixed(0);
            document.getElementById('v-category-share').textContent = params.categoryShare.toFixed(0) + '%';

            document.getElementById('p-brand-share').value = params.brandShare.toFixed(0);
            document.getElementById('v-brand-share').textContent = params.brandShare.toFixed(0) + '%';

            document.getElementById('p-prescription').value = params.prescription.toFixed(0);
            document.getElementById('v-prescription').textContent = params.prescription;

            document.getElementById('p-annual-count').value = params.annualCount.toFixed(0);
            document.getElementById('v-annual-count').textContent = params.annualCount.toFixed(0);

            document.getElementById('p-unit-price').value = params.unitPrice.toFixed(1);
            document.getElementById('v-unit-price').textContent = params.unitPrice.toFixed(1);

            document.querySelectorAll('[id^="param-year-hint"]').forEach(hint => {
                hint.textContent = `(å½“å‰: ${year}å¹´)`;
            });
        }

        // å‚æ•°æ›´æ–°å‡½æ•° (ç”¨æˆ·æ»‘åŠ¨æ»‘å—æ—¶è°ƒç”¨)
        window.updateParams = function() {
            // è¯»å–UIä¸Šçš„å€¼æ›´æ–°params
            params.totalPop = parseInt(document.getElementById('p-total-pop').value);
            params.urban = parseInt(document.getElementById('p-urban').value);
            params.prevalence = parseFloat(document.getElementById('p-prevalence').value);
            params.diagnosis = parseInt(document.getElementById('p-diagnosis').value);
            params.comorbidTD = parseInt(document.getElementById('p-comorbid-td').value);
            params.treatment = parseInt(document.getElementById('p-treatment').value);
            params.categoryShare = parseInt(document.getElementById('p-category-share').value);
            params.brandShare = parseInt(document.getElementById('p-brand-share').value);
            params.prescription = parseInt(document.getElementById('p-prescription').value);
            params.annualCount = parseInt(document.getElementById('p-annual-count').value);
            params.unitPrice = parseFloat(document.getElementById('p-unit-price').value);

            // æ›´æ–°UIæ˜¾ç¤º
            document.getElementById('v-total-pop').textContent = params.totalPop.toLocaleString();
            document.getElementById('v-urban').textContent = params.urban + '%';
            document.getElementById('v-prevalence').textContent = params.prevalence.toFixed(1) + '%';
            document.getElementById('v-diagnosis').textContent = params.diagnosis + '%';
            document.getElementById('v-comorbid-td').textContent = params.comorbidTD + '%';
            document.getElementById('v-treatment').textContent = params.treatment + '%';
            document.getElementById('v-category-share').textContent = params.categoryShare + '%';
            document.getElementById('v-brand-share').textContent = params.brandShare + '%';
            document.getElementById('v-prescription').textContent = params.prescription;
            document.getElementById('v-annual-count').textContent = params.annualCount;
            document.getElementById('v-unit-price').textContent = params.unitPrice.toFixed(1);

            // ä¿å­˜å½“å‰å¹´ä»½çš„å‚æ•°åˆ° yearSpecificParamsï¼Œä»¥ä¾¿LocalStorageä¿å­˜
            yearSpecificParams[currentYear] = { ...params };
            saveStateToLocalStorage();
            updateDisplay();
        };


        // è®¡ç®—å½“å¹´æ•°æ®ï¼Œè¿”å›ä¸€ä¸ªæ•°æ®å¯¹è±¡
        function calcYearData(year) {
            // å…ˆè·å–è¯¥å¹´ä»½çš„â€œåŸºå‡†â€å‚æ•°å€¼ (æ¥è‡ªé»˜è®¤è¶‹åŠ¿æˆ–ç”¨æˆ·è¦†ç›–)
            let effectiveParams = {
                totalPop: getDefaultTotalPop(year),
                urban: getDefaultUrbanRate(year),
                prevalence: getDefaultPrevalence(year),
                diagnosis: getDefaultDiagnosisRate(year),
                comorbidTD: getDefaultComorbidTD(year),
                treatment: getDefaultTreatment(year),
                categoryShare: getDefaultCategoryShare(year),
                brandShare: getDefaultBrandShare(year),
                prescription: getDefaultPrescription(year),
                annualCount: getDefaultAnnualCount(year),
                unitPrice: getDefaultUnitPrice(year)
            };

            // å¦‚æœæœ‰yearSpecificParams[year]çš„è¦†ç›–ï¼Œåº”ç”¨å®ƒ
            if (yearSpecificParams[year]) {
                Object.assign(effectiveParams, yearSpecificParams[year]);
            } else {
                // å¦‚æœæ²¡æœ‰yearSpecificParamsï¼Œä½†paramsæœ‰å€¼ï¼Œç¡®ä¿ä½¿ç”¨paramsçš„å½“å‰å€¼
                Object.assign(effectiveParams, params);
            }


            const urbanPop = effectiveParams.totalPop * (effectiveParams.urban / 100);
            const adhd = urbanPop * (effectiveParams.prevalence / 100);
            const diagnosed = adhd * (effectiveParams.diagnosis / 100);

            // æ ¸å¿ƒç›®æ ‡ç¾¤æ‚£è€…è§„æ¨¡ - ä½¿ç”¨æ–°å¢çš„ADHDåˆå¹¶TDæ¯”ä¾‹å‚æ•°
            const calculatedTargetGroupSize = diagnosed * (effectiveParams.comorbidTD / 100);

            const treated = diagnosed * (effectiveParams.treatment / 100);
            const category = treated * (effectiveParams.categoryShare / 100);
            const dain = category * (effectiveParams.brandShare / 100);

            const totalPieces = effectiveParams.prescription * effectiveParams.annualCount;
            const revenue = (dain * 10000) * totalPieces * effectiveParams.unitPrice / 10000; // ä½¿ç”¨ effectiveParams.unitPrice

            return {
                totalPop: effectiveParams.totalPop,
                urbanPop: urbanPop,
                adhdPatients: adhd,
                diagnosedPatients: diagnosed,
                calculatedTargetGroupSize: calculatedTargetGroupSize,
                treatedPatients: treated,
                categoryPatients: category,
                dainPatients: dain,
                revenue: revenue,
                perCapita: dain > 0 ? (revenue * 10000) / (dain * 10000) : 0,
                // å°†è®¡ç®—ç”¨çš„effectiveParamsä¹Ÿè¿”å›ï¼Œæ–¹ä¾¿æ˜¾ç¤º
                usedParams: effectiveParams
            };
        }

        // æ›´æ–°æ˜¾ç¤ºå‡½æ•°
        function updateDisplay() {
            const data = calcYearData(currentYear);
            const usedParams = data.usedParams; // è·å–è®¡ç®—æ—¶å®é™…ä½¿ç”¨çš„å‚æ•°

            // 1. æ ¸å¿ƒç›®æ ‡ç¾¤: ADHD+TD
            const currentTargetGroupSize = (data.calculatedTargetGroupSize).toFixed(1);
            document.getElementById('target-patient-group-size-display').textContent = currentTargetGroupSize;
            // document.getElementById('editable-target-group-text').innerHTML å·²ç»åœ¨ loadEditableContentsToUI ä¸­å¤„ç†

            // 2. ç«äº‰å£å’å»ºè®® - å·²ç»åœ¨ loadEditableContentsToUI ä¸­å¤„ç†
            // document.getElementById('editable-competition-text').innerHTML = editableContents.competition;

            // 3. æ‚£è€…æµæ¨¡å‹ (åŸé•‡åŒ–è¿‡æ»¤)
            document.getElementById('funnel-year').textContent = currentYear;
            document.getElementById('f-total-pop').textContent = `${(data.totalPop / 1000).toFixed(1)}äº¿`;
            document.getElementById('f-urban-pop').textContent = `${data.urbanPop.toFixed(0)}ä¸‡`;
            document.getElementById('f-adhd-patients').textContent = `${data.adhdPatients.toFixed(0)}ä¸‡`;
            document.getElementById('f-target-patients').textContent = `${currentTargetGroupSize}ä¸‡`;


            // 4. å“ç±»ä»½é¢ç°çŠ¶
            document.getElementById('category-share-year').textContent = currentYear;
            // å“ç±»ä»½é¢è¾“å…¥æ¡†çš„å€¼åœ¨ loadCategorySharesToUI ä¸­åŠ è½½
            document.getElementById('display-share-clonidine').textContent = usedParams.categoryShare.toFixed(0);
            // editable-pm-insight-text å·²ç»åœ¨ loadEditableContentsToUI ä¸­å¤„ç†
            
            updateCategorySharesSumCheck(); // ç¡®ä¿æ€»å’Œæ£€æŸ¥å™¨ä¹Ÿæ›´æ–°

            // 5. é”€å”®é¢„ä¼°
            document.getElementById('forecast-model-year').textContent = currentYear;
            document.getElementById('forecast-treatment-rate').innerHTML = `${usedParams.treatment.toFixed(0)}<span class="text-base">%</span>`;
            document.getElementById('forecast-category-share').innerHTML = `${usedParams.categoryShare.toFixed(0)}<span class="text-base">%</span>`;
            document.getElementById('forecast-brand-share').innerHTML = `${usedParams.brandShare.toFixed(0)}<span class="text-base">%</span>`;

            document.getElementById('current-forecast-year').textContent = currentYear;
            document.getElementById('current-forecast-revenue').textContent = data.revenue.toFixed(0);

            // KPI æ ·å¼æ›´æ–°å’Œå€¼
            document.getElementById('kpi-patients').textContent = (data.dainPatients * 10000).toLocaleString('zh-CN', {maximumFractionDigits: 0});
            document.getElementById('kpi-revenue').textContent = 'Â¥ ' + data.revenue.toFixed(0);
            document.getElementById('kpi-percapita').textContent = 'Â¥ ' + data.perCapita.toFixed(0);


            // æµ‹ç®—é€»è¾‘æ˜ç»†
            document.getElementById('calc-logic-year').textContent = currentYear;
            document.getElementById('calc-urban-children').textContent = (data.urbanPop).toFixed(0) + 'ä¸‡';
            document.getElementById('calc-diagnosed-children').textContent = (data.diagnosedPatients).toFixed(0) + 'ä¸‡';
            document.getElementById('calc-category-patients').textContent = (data.categoryPatients).toFixed(1) + 'ä¸‡';
            document.getElementById('calc-dain-coverage').textContent = (data.dainPatients * 10000).toLocaleString('zh-CN', {maximumFractionDigits: 0}) + 'äºº';

            // 6. PM ç­–ç•¥è´´å£« - å·²ç»åœ¨ loadEditableContentsToUI ä¸­å¤„ç†
            // document.getElementById('editable-pm-strategy-tip').innerHTML = editableContents.pmStrategy;

            updateTrendChart();
        }

        // ====== contenteditable æ–‡æœ¬å’Œå¯ç¼–è¾‘æ•°å­—çš„è¾…åŠ©å‡½æ•° ======

        // ä¿å­˜ contenteditable æ–‡æœ¬å†…å®¹
        function saveEditableContent(id, key) {
            editableContents[key] = document.getElementById(id).innerHTML;
            saveStateToLocalStorage();
        }

        // åŠ è½½ contenteditable æ–‡æœ¬å†…å®¹åˆ°UI
        function loadEditableContentsToUI() {
            document.getElementById('editable-target-group-text').innerHTML = editableContents.targetGroup;
            document.getElementById('editable-competition-text').innerHTML = editableContents.competition;
            document.getElementById('editable-pm-insight-text').innerHTML = editableContents.pmInsight;
            document.getElementById('editable-pm-strategy-tip').innerHTML = editableContents.pmStrategy;
        }

        // ç›‘å¬ contenteditable åŒºåŸŸçš„è¾“å…¥äº‹ä»¶
        document.getElementById('editable-target-group-text').addEventListener('input', () => saveEditableContent('editable-target-group-text', 'targetGroup'));
        document.getElementById('editable-competition-text').addEventListener('input', () => saveEditableContent('editable-competition-text', 'competition'));
        document.getElementById('editable-pm-insight-text').addEventListener('input', () => saveEditableContent('editable-pm-insight-text', 'pmInsight'));
        document.getElementById('editable-pm-strategy-tip').addEventListener('input', () => saveEditableContent('editable-pm-strategy-tip', 'pmStrategy'));


        // æ›´æ–°å“ç±»ä»½é¢çš„æ€»å’Œæ ¡éªŒ
        function updateCategorySharesSumCheck() {
            const stimulant = parseFloat(document.getElementById('input-share-stimulant').value) || 0;
            const atomoxetine = parseFloat(document.getElementById('input-share-atomoxetine').value) || 0;
            const guanfacine = parseFloat(document.getElementById('input-share-guanfacine').value) || 0;
            const clonidine = parseFloat(params.categoryShare) || 0; // å¯ä¹å®šä»½é¢æ¥è‡ªå·¦ä¾§å‚æ•°

            const total = stimulant + atomoxetine + guanfacine + clonidine;

            const warningDiv = document.getElementById('share-warning');

            if (Math.abs(total - 100) > 0.01) { // å…è®¸æµ®ç‚¹æ•°è¯¯å·®
                warningDiv.style.display = 'block';
            } else {
                warningDiv.style.display = 'none';
            }
        }

        // æ›´æ–°å“ç±»ä»½é¢ (ç”¨æˆ·åœ¨è¾“å…¥æ¡†ä¸­ä¿®æ”¹æ—¶è°ƒç”¨)
        window.updateCategoryShares = function() {
            const stimulant = parseFloat(document.getElementById('input-share-stimulant').value) || 0;
            const atomoxetine = parseFloat(document.getElementById('input-share-atomoxetine').value) || 0;
            const guanfacine = parseFloat(document.getElementById('input-share-guanfacine').value) || 0;

            // ä¿å­˜ç”¨æˆ·è°ƒæ•´çš„å“ç±»ä»½é¢åˆ° yearSpecificCategoryShares
            yearSpecificCategoryShares[currentYear] = {
                stimulant: stimulant,
                atomoxetine: atomoxetine,
                guanfacine: guanfacine
            };
            saveStateToLocalStorage();
            updateCategorySharesSumCheck(); // ä»…æ›´æ–°æ ¡éªŒï¼Œä¸éœ€è¦é‡æ–°æ›´æ–°æ•´ä¸ªä»ªè¡¨ç›˜
        };

        // åŠ è½½å“ç±»ä»½é¢åˆ°UI
        function loadCategorySharesToUI(year) {
            const shares = yearSpecificCategoryShares[year] || defaultCategoryShares;
            document.getElementById('input-share-stimulant').value = shares.stimulant;
            document.getElementById('input-share-atomoxetine').value = shares.atomoxetine;
            document.getElementById('input-share-guanfacine').value = shares.guanfacine;
            updateCategorySharesSumCheck(); // ç¡®ä¿åŠ è½½åä¹Ÿè¿›è¡Œæ€»å’Œæ£€æŸ¥
        }


        // ç”Ÿæˆ 2023-2035 è¶‹åŠ¿æ•°æ®
        function generateTrendData() {
            const years = [];
            const revenues = [];

            for (let y = 2023; y <= 2035; y++) {
                years.push(y);
                const data = calcYearData(y);
                revenues.push(data.revenue.toFixed(0));
            }

            return { years, revenues };
        }

        // æ›´æ–°è¶‹åŠ¿å›¾
        function updateTrendChart() {
            const { years, revenues } = generateTrendData();
            const ctx = document.getElementById('trendChart').getContext('2d');

            if (trendChart) trendChart.destroy();

            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'é¢„ä¼°å¹´åº¦è¥æ”¶ (ä¸‡å…ƒ)',
                        data: revenues,
                        borderColor: '#ec4899', /* pink-500 */
                        borderWidth: 4,
                        backgroundColor: 'rgba(236, 72, 153, 0.1)', /* pink-500 with opacity */
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#ec4899',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { 
                            display: true, 
                            labels: { 
                                font: { size: 12, weight: 'bold' },
                                color: '#d1d5db' /* text-gray-300 */
                            } 
                        },
                        tooltip: {
                            backgroundColor: '#1f2937', /* gray-800 */
                            padding: 12,
                            titleFont: { size: 13 },
                            bodyFont: { size: 12 },
                            bodyColor: '#d1d5db',
                            titleColor: '#d1d5db'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(107, 114, 128, 0.3)' }, /* gray-500 with opacity */
                            ticks: { 
                                font: { weight: 'bold' },
                                color: '#d1d5db' /* text-gray-300 */
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { 
                                font: { weight: 'bold' },
                                color: '#d1d5db' /* text-gray-300 */
                            }
                        }
                    }
                }
            });
        }

        // é‡ç½®å‚æ•°
        window.resetParams = function() {
            // æ¸…ç©ºæ‰€æœ‰å¹´ä»½çš„ç”¨æˆ·ç‰¹å®šå‚æ•°è¦†ç›–
            yearSpecificParams = {};
            yearSpecificCategoryShares = {};
            editableContents = { ...initialEditableContents }; // æ¢å¤åˆ°åˆå§‹é»˜è®¤æ–‡æœ¬

            // æ¸…é™¤ LocalStorage ä¸­çš„æ‰€æœ‰ç›¸å…³æ•°æ®
            localStorage.removeItem(LS_KEY_PARAMS);
            localStorage.removeItem(LS_KEY_CATEGORY_SHARES);
            localStorage.removeItem(LS_KEY_EDITABLE_CONTENTS);

            // é‡ç½® params ä¸ºå½“å‰å¹´ä»½çš„é»˜è®¤è¶‹åŠ¿å€¼ (å¹¶æ ¹æ® initialParams ç¡®ä¿åŸºå‡†ä¸€è‡´)
            Object.assign(params, initialParams); // ä»åŸå§‹é»˜è®¤å€¼å¼€å§‹

            // æ›´æ–°å·¦ä¾§å‚æ•°é¢æ¿çš„æ»‘å—å’Œæ˜¾ç¤ºå€¼
            loadYearParamsToUI(currentYear);
            loadEditableContentsToUI();
            loadCategorySharesToUI(currentYear);

            updateDisplay(); // é‡æ–°è®¡ç®—å¹¶æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
            alert("æ‰€æœ‰å‚æ•°å·²é‡ç½®ä¸ºé»˜è®¤å€¼ï¼Œå¹¶æ¸…é™¤äº†ä¿å­˜çš„æ•°æ®ï¼");
        };

        // ä»ªè¡¨æ¿åˆå§‹åŒ–å‡½æ•°
        function initializeDashboard() {
            loadStateFromLocalStorage(); // ä¼˜å…ˆä» LocalStorage åŠ è½½çŠ¶æ€

            // é¦–æ¬¡åŠ è½½æ—¶ï¼Œéœ€è¦ç¡®ä¿paramså¯¹è±¡æœ‰å€¼ï¼Œæ ¹æ®currentYearæ›´æ–°ä¸€æ¬¡
            // å¦‚æœlocalStorageæ²¡æœ‰è¦†ç›–currentYearï¼Œåˆ™paramsä¼šä¿ç•™initialParamsçš„é»˜è®¤å€¼
            // å¦‚æœlocalStorageæœ‰è¦†ç›–ï¼Œåˆ™ä¼šåœ¨loadYearParamsToUIä¸­åŠ è½½è¿›æ¥
            loadYearParamsToUI(currentYear); 
            loadEditableContentsToUI();
            loadCategorySharesToUI(currentYear);
            
            switchYear(currentYear); // åˆå§‹åŒ–æ˜¾ç¤ºå½“å‰å¹´ä»½çš„æ•°æ®
        }
    });
</script>
</body>
</html>
